import os, struct, json, zlib, shutil

print("SKUSCENE ENCRYPTOR BY: JACKLSUMMER15")

with open("input.json") as f:
  sku=json.load(f)

mapnames=sku[0]["songs"]

map_count=0

try:
	os.mkdir('output')
	
except:
	pass

skuenc=open("output/skuscene_maps_pc_all.isc.ckd","wb")

skudb="skuscene_db"
skubasetpl="skuscene_base.tpl"
skubasepath="world/skuscenes/"


skuenc.write(b'\x00\x00\x00\x01\x00\x01\x7F\x47\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')

skuenc.write(struct.pack(">I",1+len(mapnames)))

# skuscene base & skuscene db
skuenc.write(b'\x97\xCA\x62\x8B\x00\x00\x00\x00\x3F\x80\x00\x00\x3F\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0B\x73\x6B\x75\x73\x63\x65\x6E\x65\x5F\x64\x62\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x1C\x77\x6F\x72\x6C\x64\x2F\x6A\x64\x35\x2F\x5F\x63\x6F\x6D\x6D\x6F\x6E\x2F\x73\x6B\x75\x73\x63\x65\x6E\x65\x73\x2F\x00\x00\x00\x11\x73\x6B\x75\x73\x63\x65\x6E\x65\x5F\x62\x61\x73\x65\x2E\x74\x70\x6C\xC8\x62\xB4\x58\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x40\x55\x79\xFB')

for i, mapname in enumerate(mapnames,1):
  mapnamelow=mapname.lower()
  print("adding "+mapname+"...")
  songdesctpl="songdesc.tpl"
  songdescpath="world/jd5/"+mapnamelow+"/"

  skuenc.write(b'\x97\xCA\x62\x8B\x00\x00\x00\x00\x3F\x80\x00\x00\x3F\x80\x00\x00\x00\x00\x00\x00')

  skuenc.write(struct.pack(">I",len(mapname))+mapname.encode())

  skuenc.write(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF\xFF\xFF\x00\x00\x00\x00')

  skuenc.write(struct.pack(">I",len(songdescpath))+songdescpath.encode())

  skuenc.write(struct.pack(">I",len(songdesctpl))+songdesctpl.encode()+struct.pack("<I",zlib.crc32(songdescpath.encode())))

  skuenc.write(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xE0\x7F\xCC\x3F')

  map_count+=1

skuenc.write(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xF8\x78\xDC\x2D\x00\x00\x00\x0E\x46\x69\x6E\x61\x6C\x5F\x57\x69\x69\x55\x5F\x4E\x4F\x41\x00\x00\x00\x1F\x65\x6E\x67\x69\x6E\x65\x64\x61\x74\x61\x2F\x62\x6F\x6F\x74\x73\x65\x71\x75\x65\x6E\x63\x65\x2F\x72\x61\x74\x69\x6E\x67\x2F\x00\x00\x00\x13\x72\x61\x74\x69\x6E\x67\x5F\x65\x73\x72\x62\x5F\x31\x36\x39\x2E\x69\x73\x63\x34\xD3\x46\x78\x00\x00\x00\x00')

skuenc.write(struct.pack(">I",len(mapnames)))

for i, mapname in enumerate(mapnames,1):
  mapnamelow=mapname.lower()

  covergenericact=mapnamelow+"_cover_generic.act"
  menuartpath="world/jd5/"+mapnamelow+"/menuart/actors/"

  skuenc.write(struct.pack(">I",len(mapname))+mapname.encode())

  skuenc.write(struct.pack(">I",len(menuartpath))+menuartpath.encode())

  skuenc.write(struct.pack(">I",len(covergenericact))+covergenericact.encode()+struct.pack("<I",zlib.crc32(covergenericact.encode())))

  skuenc.write(b'\x00\x00\x00\x00\x00\x00\x00\x00')

  map_count+=1

skuenc.close()

